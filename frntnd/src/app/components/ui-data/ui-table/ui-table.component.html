@if (enableFilter) {
<div class="w-full" style="margin-bottom: 12px">
  <ui-input
    label="Filtrar"
    [value]="filterText"
    (valueChange)="setFilter($event)"
    placeholder="Buscar..."
    id="ui-table-filter"
  ></ui-input>
</div>
}

<div class="table-responsive w-full max-w-full bg-centera">
  <table class="table w-full">
    @if (paged.length > 0) {
    <ui-thead>
      <ui-tr>
        @for (col of visibleColumns; track col.key) {
        <ui-th
          scope="col"
          (click)="toggleSort(col)"
          [attr.role]="enableSort ? 'button' : null"
          [attr.tabindex]="enableSort ? 0 : null"
          (keydown.enter)="toggleSort(col)"
          (keydown.space)="toggleSort(col)"
          [attr.aria-sort]="
            sortKey === col.key ? (sortDir === 'asc' ? 'ascending' : 'descending') : 'none'
          "
          [attr.aria-label]="
            'Ordenar por ' +
            col.label +
            '. Estado: ' +
            (sortKey === col.key
              ? sortDir === 'asc'
                ? 'ascendente'
                : 'descendente'
              : 'sin ordenar')
          "
        >
          {{ col.label }}
          @if (sortKey === col.key && sortDir) {
          <span class="muted">{{ sortDir === 'asc' ? '▲' : '▼' }}</span>
          }
        </ui-th>
        } @if (showActions) {
        <ui-th scope="col" class="bg-center">Acciones</ui-th>
        }
      </ui-tr>
    </ui-thead>
    }
    <ui-tbody>
      @if (paged.length > 0) { @for (row of paged; track $index) {
      <ui-tr>
        @for (col of visibleColumns; track col.key) {
        <ui-td>
          @if (col.type === 'image') {
          <img
            [src]="row[col.key] || '/api/uploads/usuarios/no-img.png'"
            [attr.alt]="col.label"
            style="
              width: 32px;
              height: 32px;
              object-fit: cover;
              border-radius: var(--radius-sm);
              border: 1px solid var(--color-border);
            "
          />
          } @else {
          {{ row[col.key] }}
          }
        </ui-td>
        } @if (showActions) {
        <ui-td>
          <div style="display: flex; gap: 8px; justify-content: center; width: 100%" class="w-full">
            <ui-button
              label="Editar"
              variant="success"
              icon="edit"
              [iconOnly]="true"
              (pressed)="emitEdit(row)"
              ariaLabel="Editar"
            ></ui-button>
            <ui-button
              label="Eliminar"
              variant="danger"
              icon="delete"
              [iconOnly]="true"
              (pressed)="emitRemove(row)"
              ariaLabel="Eliminar"
            ></ui-button>
          </div>
        </ui-td>
        }
      </ui-tr>
      } } @else {
      <ui-tr>
        <ui-td [attr.colspan]="visibleColumns.length + (showActions ? 1 : 0)" class="muted">
          No hay resultados
        </ui-td>
      </ui-tr>
      }
    </ui-tbody>
  </table>
</div>

@if (shouldShowPagination) {
<div
  class="flex items-center gap-2 mt-2 justify-center bg-white rounded shadow-sm p-2 bg-center"
  role="status"
  aria-live="polite"
>
  <ui-button
    label="Primera"
    variant="outline"
    (pressed)="firstPage()"
    [disabled]="page === 1"
  ></ui-button>
  <ui-button
    label="Anterior"
    variant="outline"
    (pressed)="prevPage()"
    [disabled]="page === 1"
  ></ui-button>
  <ui-button
    label="Siguiente"
    variant="outline"
    (pressed)="nextPage()"
    [disabled]="page === totalPages"
  ></ui-button>
  <ui-button
    label="Última"
    variant="outline"
    (pressed)="lastPage()"
    [disabled]="page === totalPages"
  ></ui-button>
  <span class="muted ml-auto">Tamaño:</span>
  <select
    [value]="pageSize"
    (change)="changePageSize(+$any($event.target).value)"
    id="ui-table-page-size"
    name="ui-table-page-size"
    aria-label="Tamaño de página"
    class="px-2 py-1 bg-white border border-gray-300 text-gray-700 rounded"
  >
    @for (opt of pageSizeOptions; track opt) {
    <option [value]="opt">{{ opt }} por página</option>
    }
  </select>
</div>
}
