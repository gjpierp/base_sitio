<form (ngSubmit)="aplicarFiltros()">
  <!-- Card de título, subtítulo y botón crear -->
  <ui-card>
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      <div style="display: flex; align-items: center; justify-content: space-between; width: 100%">
        <h2 style="margin: 0; font-weight: bold; font-size: 16px">{{ title }}</h2>
        <ui-button
          variant="primary"
          (pressed)="openCreateModal()"
          icon="add"
          [iconOnly]="true"
          ariaLabel="Crear"
          title="Crear"
        ></ui-button>
      </div>
      <div style="color: #888; font-size: 12px; margin-top: 0.2em">{{ subtitle }}</div>
    </div>
  </ui-card>

  <!-- Card de filtros -->
  <ui-card title="Filtros de búsqueda" style="margin-top: 1.5rem">
    <div
      style="
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
      "
    >
      <input
        type="text"
        [(ngModel)]="filtroNombre"
        name="filtroNombre"
        placeholder="Nombre"
        style="width: 180px"
      />
      <input
        type="text"
        [(ngModel)]="filtroDescripcion"
        name="filtroDescripcion"
        placeholder="Descripción"
        style="width: 180px"
      />
      <select [(ngModel)]="filtroEstado" name="filtroEstado" style="width: 160px">
        <option value="">Estado</option>
        <option *ngFor="let e of estados" [value]="e.id_estado">{{ e.nombre }}</option>
      </select>
    </div>
    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem">
      <ui-button
        type="submit"
        variant="primary"
        icon="search"
        [iconOnly]="true"
        ariaLabel="Buscar"
        title="Buscar"
      ></ui-button>
      <ui-button
        type="button"
        variant="primary"
        icon="clear"
        [iconOnly]="true"
        ariaLabel="Limpiar"
        title="Limpiar"
        (pressed)="limpiarFiltros()"
      ></ui-button>
    </div>
  </ui-card>

  <!-- Card de registros -->
  <ui-card style="margin-top: 1.5rem">
    <div style="width: 100%">
      <ng-container *ngIf="loading">
        <ui-spinner></ui-spinner>
      </ng-container>
      <ng-container *ngIf="!loading">
        <ui-entity-table
          [title]="title"
          [subtitle]="subtitle"
          [columns]="columns"
          [data]="formattedData"
          [total]="totalRoles"
          [loading]="loading"
          [error]="error"
          [page]="currentPage"
          (edit)="openEditModal($event)"
          (remove)="onRemove($event)"
          (pageChange)="onPageChange($event)"
          style="width: 100%"
        ></ui-entity-table>
      </ng-container>
    </div>
    <div
      class="table-pagination"
      style="
        margin-top: 0.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
      "
    >
      <ui-pagination></ui-pagination>
    </div>
  </ui-card>
</form>

<!-- Integrated modal for create/edit/delete -->
<ui-modal
  [isOpen]="modalOpen"
  [title]="modalTitle"
  (confirmed)="onModalConfirm()"
  (closed)="onModalClosed()"
>
  <div class="content">
    <form *ngIf="modalFields.length" (submit)="$event.preventDefault(); onModalConfirm()">
      <div class="form-grid" [class.many-fields]="modalFields.length > 6">
        <div class="form-row" *ngFor="let f of modalFields">
          <label class="form-label" [for]="f.key" title="{{ f.label }}">{{ f.label }}</label>
          <div class="form-input">
            <ng-container [ngSwitch]="f.type">
              <ng-container *ngSwitchCase="'text'">
                <input [id]="f.key" [(ngModel)]="modalValues[f.key]" [name]="f.key" />
              </ng-container>
              <ng-container *ngSwitchCase="'select'">
                <select [id]="f.key" [(ngModel)]="modalValues[f.key]" [name]="f.key">
                  <option *ngFor="let o of f.options || []" [value]="o.value">{{ o.label }}</option>
                </select>
              </ng-container>
              <ng-container *ngSwitchCase="'textarea'">
                <textarea [id]="f.key" [(ngModel)]="modalValues[f.key]" [name]="f.key"></textarea>
              </ng-container>
              <ng-container *ngSwitchDefault>
                <input [id]="f.key" [(ngModel)]="modalValues[f.key]" [name]="f.key" />
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </form>
    <div *ngIf="!modalFields.length && modalDeleteMode" style="padding: 1rem">
      <p>
        ¿Confirma eliminar el rol "<strong>{{ modalValues.nombre }}</strong
        >"?
      </p>
    </div>
  </div>
</ui-modal>
