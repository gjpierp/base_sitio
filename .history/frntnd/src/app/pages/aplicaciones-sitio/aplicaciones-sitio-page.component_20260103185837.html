<div class="page-animate" [class.page-ready]="datosListos">
  <ui-card [title]="title" [subtitle]="subtitle">
    <div class="spread" style="margin-bottom: 1rem; align-items: center; display:flex; gap:0.5rem;">
      @if(loading){
      <ui-spinner label="Cargando"></ui-spinner>
      } @if(!loading && error){
      <div class="muted">{{ error }}</div>
      }
      @if(!loading){
      <div style="margin-left:auto">
        <button class="btn primary" (click)="openCreateModal()">Crear</button>
      </div>
      }
    </div>
    @if(!loading && datosListos){
    <ui-entity-table
      [title]="title"
      [subtitle]="subtitle"
      [columns]="columns"
      [data]="data"
      [loading]="loading"
      [error]="error"
      (edit)="onEdit($event)"
      (remove)="onRemove($event)"
    ></ui-entity-table>
    }
  </ui-card>
</div>

<!-- Modal integrado para creación/edición -->
<ui-modal
  [open]="modalOpen"
  [title]="modalTitle"
  (confirmed)="onModalConfirm()"
  (closed)="onModalClosed()"
>
  <div class="content">
    <form
      *ngIf="modalFields?.length"
      class="form-grid"
      (submit)="$event.preventDefault(); onModalConfirm()"
    >
      <ng-container *ngFor="let f of modalFields">
        <label [for]="f.key">{{ f.label }}</label>
        <ng-container [ngSwitch]="f.type">
          <input
            *ngSwitchCase="'text'"
            [id]="f.key"
            [(ngModel)]="modalValues[f.key]"
            name="{{ f.key }}"
          />
          <select
            *ngSwitchCase="'select'"
            [id]="f.key"
            [(ngModel)]="modalValues[f.key]"
            name="{{ f.key }}"
          >
            <option *ngFor="let o of f.options || []" [value]="o.value">{{ o.label }}</option>
          </select>
          <textarea
            *ngSwitchCase="'textarea'"
            [id]="f.key"
            [(ngModel)]="modalValues[f.key]"
            name="{{ f.key }}"
          ></textarea>
          <input
            *ngSwitchDefault
            [id]="f.key"
            [(ngModel)]="modalValues[f.key]"
            name="{{ f.key }}"
          />
        </ng-container>
      </ng-container>
    </form>
  </div>
</ui-modal>
