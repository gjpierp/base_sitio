<div class="page-animate" [class.page-ready]="datosListos">
  <ui-card [title]="title" [subtitle]="subtitle">
    <div
      class="spread"
      style="margin-bottom: 1rem; align-items: center; display: flex; gap: 0.5rem"
    >
      <ui-spinner *ngIf="loading" label="Cargando"></ui-spinner>
      <div *ngIf="!loading && error" class="muted">{{ error }}</div>
      <ng-container *ngIf="!loading">
        <div style="margin-left: auto">
          <button type="button" class="btn primary" (click)="openCreateModal()">
            <span style="display: inline-flex; align-items: center; gap: 0.5rem">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path
                  d="M12 5v14M5 12h14"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Crear
            </span>
          </button>
        </div>
      </ng-container>
    </div>
    <div *ngIf="!loading && datosListos">
      <ui-entity-table
        [title]="title"
        [subtitle]="subtitle"
        [total]="totalRoles"
        [page]="currentPage"
        (pageChange)="onPageChange($event)"
        [columns]="columns"
        [data]="data"
        [loading]="loading"
        [error]="error"
        (edit)="onEdit($event)"
        (remove)="onRemove($event)"
      ></ui-entity-table>
    </div>
  </ui-card>
</div>

<!-- Integrated modal for create/edit/delete -->
<ui-modal
  [open]="modalOpen"
  [title]="modalTitle"
  (confirmed)="onModalConfirm()"
  (closed)="onModalClosed()"
>
  <div class="content">
    <form *ngIf="modalFields.length" (submit)="$event.preventDefault(); onModalConfirm()">
      <table class="form-table">
        <tr *ngFor="let f of modalFields">
          <th>
            <label
              [for]="f.key"
              style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 220px; display: inline-block;"
              >{{ f.label }}</label
            >
          </th>
          <td>
            <ng-container [ngSwitch]="f.type">
              <ng-container *ngSwitchCase="'text'">
                <input
                  [id]="f.key"
                  [(ngModel)]="modalValues[f.key]"
                  [name]="f.key"
                  style="width: 360px; max-width: 100%; box-sizing: border-box"
                />
              </ng-container>
              <ng-container *ngSwitchCase="'textarea'">
                <textarea
                  [id]="f.key"
                  [(ngModel)]="modalValues[f.key]"
                  [name]="f.key"
                  style="width: 360px; max-width: 100%; box-sizing: border-box"
                ></textarea>
              </ng-container>
              <ng-container *ngSwitchDefault>
                <input
                  [id]="f.key"
                  [(ngModel)]="modalValues[f.key]"
                  [name]="f.key"
                  style="width: 360px; max-width: 100%; box-sizing: border-box"
                />
              </ng-container>
            </ng-container>
          </td>
        </tr>
      </table>
    </form>
    <div *ngIf="!modalFields.length && modalDeleteMode" style="padding: 1rem">
      <p>
        Â¿Confirma eliminar el rol "<strong>{{ modalValues.nombre }}</strong>"?
      </p>
    </div>
  </div>
</ui-modal>
